<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:batch="http://www.springframework.org/schema/batch"
  xmlns:context="http://www.springframework.org/schema/context"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
    http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch.xsd">

    <context:property-placeholder
      ignore-resource-not-found="true"
      location="classpath*:META-INF/spring/application.properties"/>
  <context:annotation-config />

  <batch:job id="DeleteResource">
    <batch:description>Check a resource has no dependents, then delete</batch:description>
    <batch:step id="ItemChecker">
     <batch:description>Check database for records that depend on a resource</batch:description>
      <batch:tasklet ref="ItemCheckerTasklet">
      	<batch:listeners>
      		<batch:listener ref="CheckingStepExcutionListener" />
      	</batch:listeners>
      </batch:tasklet>
      <batch:end on="DELETE FAILED"/>
      <batch:next on="READY FOR DELETE" to="ItemDeleterTasklet"/>
    </batch:step>
    <batch:step id="ItemDeleterTasklet">
     <batch:description>Check database for records that depend on a resource</batch:description>
      <batch:tasklet ref="ItemDeleter"/>
         <batch:listeners>
      		<batch:listener ref="DeletingStepExcutionListener" />
      	</batch:listeners>
     </batch:step>
     <batch:listeners>
     	<batch:listener ref="JobListener"/>
     </batch:listeners>
  </batch:job>

  <bean id="ItemCheckerTasklet" class="org.emonocot.job.delete.ItemCheckerTasklet">
  	<property name="jdbcTemplate" ref="jdbcTemplate"/>
  </bean>
  
   <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
     <property name="dataSource" ref="dataSource"/>
   </bean>
	
	<bean id="CheckingStepExcutionListener" class="org.emonocot.job.delete.CheckingStepExcutionListener">
   </bean>
   
   <bean id="DeletingStepExcutionListener" class="org.emonocot.job.delete.DeletingStepExcutionListener">
   </bean>
   
	<bean id="JobListener" class="org.emonocot.job.delete.JobListener">
		<property name="resourceService" ref="resourceServiceImpl"/>
	</bean>

	<bean id="ItemDeleter" class="org.emonocot.job.delete.HibernateDeletingTasklet">
		<property name="sessionFactory" ref="sessionFactory" />
		<property name="solrServer" ref="solrServer" />
   </bean>
   
   

</beans>
